!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var B=require("tslib"),J=B.__importStar(require("react")),K=require("react-gesture-responder"),Q=require("react-spring"),U=require("./use-measure"),V=require("react-remove-scroll"),W=require("./use-previous");exports.default=J.forwardRef(function(e,n){var t=e.children,r=e.id,o=e.value,u=e.onRequestChange,i=(e.focusOnChange,e.enableScrollLock),a=void 0===i||i,l=e.enableGestures,s=void 0===l||l,c=e.enableMouse,f=void 0!==c&&c,d=e.lazyLoad,v=void 0!==d&&d,m=e.onSetLazy,h=e.animationConfig,y=void 0===h?{tension:190,friction:20,mass:.4}:h,S=e.onTerminationRequest,p=e.onMoveShouldSet,g=e.style,x=B.__rest(e,["children","id","value","onRequestChange","focusOnChange","enableScrollLock","enableGestures","enableMouse","lazyLoad","onSetLazy","animationConfig","onTerminationRequest","onMoveShouldSet","style"]),b=J.useRef(null),R=J.useState(!1),_=R[0],w=R[1],M=J.useState(function(){return new Set(m?m(o):[o])}),q=M[0],E=M[1],C=U.useMeasure(b).width,G=J.useRef(null),z=J.useRef(new Map),L=W.usePrevious(o),k=J.useRef(null);function T(e){var n=z.current.get(e);n&&n.focus()}J.useEffect(function(){k.current="number"==typeof L&&L!==o?o:null},[L,o]),J.useImperativeHandle(n,function(){return{focus:function(e){T(e||o)}}});var D=Q.useSpring(function(){return{x:-100*o,config:y}}),N=D[0].x,O=D[1];function j(){"number"==typeof k.current&&T(k.current)}var A=t.filter(function(e){return null!==e}),H=A.length-1,I=0;function P(e){return 0<e&&e<=H}function F(e){var n=C/2;Math.abs(e)>n?e<0&&o<H?u(o+1):0<e&&I<o?u(o-1):O({x:-100*o}):O({x:-100*o,onRest:j})}J.useEffect(function(){O({x:-100*o,onRest:j}),q.add(o)},[o]);var X=K.useGestureResponder({onTerminationRequest:S,onStartShouldSet:function(){return s&&(G.current=null),!1},onMoveShouldSet:function(e,n){var t=e.initial,r=e.xy;if(!s)return!1;var i=G.current||function(e,n){var t=Math.abs(e[0]-n[0]),r=Math.abs(e[1]-n[1]);return t===r?null:r<t?"horizontal":"vertical"}(t,r);G.current||(G.current=i);var o="horizontal"===i;return p?p(e,n,o):o},onGrant:function(){w(!0)},onMove:function(e){var n=e.delta,t=e.direction,r=n[0];O({x:r/C*100+-100*o,immediate:!0,onRest:function(){}}),function(n){if(P(n)){var e=n;m&&(e=m(n));var t=Array.isArray(e)?e:[e],r=new Set(q);t.forEach(function(e){!q.has(e)&&P(n)&&r.add(e)}),E(r)}}(0<t[0]?o-1:o+1)},onRelease:function(e){var n=e.delta,t=e.velocity,r=e.direction,i=n[0];return w(!1),.2<t&&0<r[0]&&I<o?u(o-1):.2<t&&r[0]<0&&o<H?u(o+1):void F(i)},onTerminate:function(e){var n=e.delta;w(!1),F(n[0])}},{uid:r,enableMouse:f}).bind;return J.createElement(J.Fragment,null,_&&a&&J.createElement(V.RemoveScroll,null,J.createElement("div",null)),J.createElement("div",B.__assign({},X,{ref:b,className:"Gesture-view",style:B.__assign({display:"flex",flexDirection:"column",overflow:"hidden",width:"100%"},g)},x),J.createElement(Q.animated.div,{className:"Gesture-view__animated-container",style:{flexDirection:"row",direction:"ltr",willChange:"transform",minHeight:0,flex:1,display:"flex",transform:N.interpolate(function(e){return"translateX("+function(e,n){if(0<e)return.3*e;if(e<n){var t=e-n;return e-.7*t}return e}(e,-100*H)+"%)"})}},A.map(function(e,n){var t={key:n,tabIndex:o===n?0:-1,style:{display:"flex",flexDirection:"column",width:"100%",alignSelf:"stretch",justifyContent:"flex-start",flexShrink:0,height:"100%",overflow:"hidden",outline:"none"},"aria-hidden":n!==o,ref:function(e){z.current.set(n,e)}},r=!v||o===n||q.has(n);return"function"==typeof e?e(t,o===n,r):J.createElement("div",B.__assign({className:"Gesture-view__pane"},t),r&&e)}))))})});
